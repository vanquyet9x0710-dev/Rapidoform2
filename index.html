<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>WAREHOUSE RAPIDO ASIA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
body { background: #f5f7fa; font-family: inherit; padding: 10px; }
.box { max-width: 900px; margin: auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
#status-message { margin-top: 10px; font-weight: bold; transition: color 0.3s ease; }
#status-message.success { color: green; }
#status-message.error { color: red; }
.input.error, .select.error select { border-color: red; }
@media screen and (max-width: 768px) {
  .columns { flex-direction: column; }
  .column { width: 100% !important; margin-bottom: 12px; }
  .input, .select select, .textarea { font-size: 16px; padding: 12px; }
  label.label { font-size: 14px; margin-bottom: 6px; }
  button.button { font-size: 18px; padding: 12px; }
}
</style>
</head>
<body>

<section class="hero is-link">
  <div class="hero-body has-text-centered">
    <h1 class="title">WAREHOUSE RAPIDO ASIA</h1>
    <p class="subtitle">REQUEST INBOUND - OUTBOUND</p>
  </div>
</section>

<div class="box mt-4">
<form id="truck-form">

<!-- Biển số xe -->
<div class="columns is-multiline">
  <div class="column is-full-mobile">
    <label class="label">Biển số xe</label>
    <input class="input" type="text" name="bien_so_xe" placeholder="29H-04321" required>
  </div>
</div>

<!-- Đơn vị -->
<div class="columns is-multiline">
  <div class="column is-full-mobile">
    <label class="label">Đơn vị</label>
    <div class="select is-fullwidth">
      <select name="don_vi" id="don_vi_select" required>
        <option value="" disabled selected>Chọn đơn vị</option>
        <option value="Q2C">Q2C</option>
        <option value="Sơn Hùng">Sơn Hùng</option>
        <option value="VT89">VT89</option>
        <option value="Tiến Lợi">Tiến Lợi</option>
        <option value="CBT">CBT</option>
        <option value="KH Tự lấy">KH Tự lấy</option>
        <option value="khac">Đơn vị khác</option>
      </select>
    </div>
    <input type="text" name="don_vi_khac" id="don_vi_khac_input" placeholder="Nhập tên đơn vị khác" style="display:none; margin-top:6px;">
  </div>
</div>

<!-- Loại xe, tải trọng, loại yêu cầu, loại hàng -->
<div class="columns is-multiline">
  <div class="column is-full-mobile">
    <label class="label">Loại xe</label>
    <div class="select is-fullwidth">
      <select name="loai_xe" required>
        <option value="" disabled selected>Chọn loại xe</option>
        <option>Xe tải</option>
        <option>Container</option>
      </select>
    </div>
  </div>
  <div class="column is-full-mobile">
    <label class="label">Tải trọng</label>
    <div class="select is-fullwidth">
      <select name="tai_trong" required>
        <option value="" disabled selected>Chọn tải trọng</option>
        <option>1.4T</option>
        <option>2T</option>
        <option>2.5T</option>
        <option>3.5T</option>
        <option>5T</option>
        <option>7T</option>
        <option>8T</option>
        <option>9T</option>
        <option>Cont 20</option>
        <option>Cont 40</option>
      </select>
    </div>
  </div>
  <div class="column is-full-mobile">
    <label class="label">Loại yêu cầu</label>
    <div class="select is-fullwidth">
      <select name="loai_yeu_cau" required>
        <option value="" disabled selected>Chọn loại yêu cầu</option>
        <option>Xuất kho</option>
        <option>Nhập kho</option>
      </select>
    </div>
  </div>
  <div class="column is-full-mobile">
    <label class="label">Loại hàng</label>
    <div class="select is-fullwidth">
      <select name="loai_hang" required>
        <option value="" disabled selected>Chọn loại hàng</option>
        <option>Thành phẩm</option>
        <option>Nguyên vật liệu</option>
      </select>
    </div>
  </div>
</div>

<hr>

<!-- Thời gian các bước -->
<div class="columns is-multiline">
  <div class="column is-full-mobile">
    <label class="label">Thời gian xe vào cổng</label>
    <input type="datetime-local" class="input" name="vao_cong">
  </div>
  <div class="column is-full-mobile">
    <label class="label">Bắt đầu chuẩn bị hàng</label>
    <input type="datetime-local" class="input" name="bat_dau_chuan_bi">
  </div>
  <div class="column is-full-mobile">
    <label class="label">Kết thúc chuẩn bị hàng</label>
    <input type="datetime-local" class="input" name="ket_thuc_chuan_bi">
  </div>
  <div class="column is-full-mobile">
    <label class="label">Bắt đầu quét hàng</label>
    <input type="datetime-local" class="input" name="bat_dau_quet">
  </div>
  <div class="column is-full-mobile">
    <label class="label">Kết thúc quét hàng</label>
    <input type="datetime-local" class="input" name="ket_thuc_quet">
  </div>
  <div class="column is-full-mobile">
    <label class="label">Bắt đầu bốc hàng</label>
    <input type="datetime-local" class="input" name="bat_dau_boc">
  </div>
  <div class="column is-full-mobile">
    <label class="label">Kết thúc bốc hàng</label>
    <input type="datetime-local" class="input" name="ket_thuc_boc">
  </div>
  <div class="column is-full-mobile">
    <label class="label">Thời gian xe ra cổng</label>
    <input type="datetime-local" class="input" name="ra_cong">
  </div>
</div>

<hr>

<!-- Nhân lực & ghi chú -->
<div class="columns is-multiline">
  <div class="column is-full-mobile">
    <label class="label">Nhân lực</label>
    <div class="select is-fullwidth">
      <select name="nhan_luc" required>
        <option value="" disabled selected>Chọn nhân lực</option>
        <option>Bốc xếp ngoài</option>
        <option>Tự bốc</option>
      </select>
    </div>
  </div>
  <div class="column is-full-mobile">
    <label class="label">Ghi chú</label>
    <textarea class="textarea" name="ghi_chu"></textarea>
  </div>
</div>

<button class="button is-link is-fullwidth" type="submit">GỬI THÔNG TIN</button>
<div id="status-message"></div>
</form>
</div>

<script>
$(document).ready(function(){
  // Hiện input khi chọn "Đơn vị khác"
  $('#don_vi_select').on('change', function(){
    if ($(this).val() === 'khac') {
      $('#don_vi_khac_input').show().attr('required', true);
    } else {
      $('#don_vi_khac_input').hide().attr('required', false).val('');
    }
  });

  $('#truck-form').on('submit', function(e){
    e.preventDefault();
    const $form = $(this);
    const $status = $('#status-message');
    const $btn = $form.find('button[type="submit"]');

    $status.removeClass('success error').text('Đang gửi dữ liệu...');
    $btn.prop('disabled', true);

    // Validation thời gian tổng thể
    const steps = [
      ['bat_dau_chuan_bi', 'ket_thuc_chuan_bi'],
      ['bat_dau_quet', 'ket_thuc_quet'],
      ['bat_dau_boc', 'ket_thuc_boc']
    ];
    for (let [startName, endName] of steps) {
      const start = $(`input[name="${startName}"]`).val();
      const end = $(`input[name="${endName}"]`).val();
      if (start && end && start > end) {
        $status.addClass('error').text(`Lỗi: ${startName} không được lớn hơn ${endName}`);
        $btn.prop('disabled', false);
        return;
      }
    }

    // Nếu chọn "Đơn vị khác", tạo input ẩn copy giá trị
    if ($('#don_vi_select').val() === 'khac') {
      $('<input>').attr({
        type: 'hidden',
        name: 'don_vi',
        value: $('#don_vi_khac_input').val()
      }).appendTo($form);
    }

    // AJAX gửi dữ liệu
    $.ajax({
      url: 'https://script.google.com/macros/s/AKfycbwYRMfKW9NU3p-G1K2bmYksylNuNiFXm9zIOfA8Dvz8aqjtiMkmD5CA4Mf091FJwgTxbg/exec', // Thay bằng URL Web App
      method: 'POST',
      data: $form.serialize(),
      success: () => {
        $status.addClass('success').text('Gửi dữ liệu thành công!');
        $form[0].reset();
        $('#don_vi_khac_input').hide();
        $('input[name="bien_so_xe"]').focus();
      },
      error: () => $status.addClass('error').text('Có lỗi xảy ra, vui lòng thử lại.'),
      complete: () => $btn.prop('disabled', false)
    });
  });
});
</script>
</body>
</html>

